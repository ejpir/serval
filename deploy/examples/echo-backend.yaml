# Echo backend deployment for testing serval-gateway
# Deploy: kubectl apply -f deploy/examples/echo-backend.yaml
---
apiVersion: apps/v1
kind: Deployment
metadata:
    name: echo-backend
    namespace: default
    labels:
        app: echo-backend
spec:
    replicas: 2
    selector:
        matchLabels:
            app: echo-backend
    template:
        metadata:
            labels:
                app: echo-backend
        spec:
            containers:
                - name: echo-backend
                  image: echo-backend:latest
                  imagePullPolicy: Never # Use local image
                  args:
                      - "--port"
                      - "8080"
                      - "--id"
                      - "$(POD_NAME)"
                  env:
                      - name: POD_NAME
                        valueFrom:
                            fieldRef:
                                fieldPath: metadata.name
                  ports:
                      - containerPort: 8080
                        name: http
                  readinessProbe:
                      httpGet:
                          path: /health
                          port: 8080
                      initialDelaySeconds: 2
                      periodSeconds: 5
                  livenessProbe:
                      httpGet:
                          path: /health
                          port: 8080
                      initialDelaySeconds: 5
                      periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
    name: echo-backend
    namespace: default
spec:
    selector:
        app: echo-backend
    ports:
        - name: http
          port: 8080
          targetPort: 8080
